\input texinfo          @c -*-texinfo-*-

@c %**start of header
@setfilename 159.info
@settitle VLA Archive Tape Data Format
@c %**end of header

@finalout
@titlepage
@center VLA Computer Memorandum 186
@sp 4
@center @titlefont{VLA Archive Data Format}
@sp 2
@center June 1, 1993
@sp 6
@center @titlefont{G. C. Hunt, K. P. Sowinski, and T. J. Bottomly}
@page
@end titlepage

@setchapternewpage on

@ifinfo
@node Top, Overview, (dir), (dir)
@top VLA Archive Tape Format

This is the reference description of the VLA archive tape

@end ifinfo

@menu
* Overview::			
* The Data Areas::		
* Record Layout::		
* ModComp Numeric Data Types::	
* RCA details::			
* SDA details::			
* ADA details::			
* CDA details::			
* References::			

 --- The Detailed Node Listing ---

Overview

* Tape Format::			
* Record Blocking::		
* Logical Record Structure::	

The Data Areas

* The Record Control Area::	
* The Subarray Data Area::	
* The Antenna Data Area::	
* The Correlator Data Area::	

The Correlator Data Area

* CDA layout::			
* Baseline Record Header::	
* The Scale Factor::		

RCA Details

* Revision History::		

SDA Details

* Array Configurations::	
* Observing Modes::		
* Calibrator Codes::		
* Observing Submodes::		
* Array Status Information::	
* Channels per Baseline::	
* Bandwidth Codes::		
* Front-End Filter Codes::	
* Array Control Bits::		
* Weather Information::		
* Velocity Reference Frame::	
* Correlator Modes::		
* Array Processor Options::	
* Epoch::			

ADA Details

* Antenna Control Bits::	

CDA Details

* CDA Pointer Definitions::	
* CDA Diagram for Continuum::	
* CDA Diagram for Spectral Line::  
@end menu

@node Overview, The Data Areas, Top, Top
@chapter Overview

This memo is a revision of an unpublished note dated October 14, 1987; it
succeeds and replaces all older versions.  The purpose is to describe the
format of the observation data written by the VLA on-line computers.

Observation data is written by the VLA on-line computers sequentially as the
observations are made.  The VLA may be configured to operate as up to five
(more or less) independent telescopes; these are known as subarrays.  At the
end of each integration time, a data record (a @emph{logical record}) for each
of the active subarrays is written to the archive tape.  There is no buffering
or sorting.  (At some future date, the restriction that all subarrays have the
same integration intervals may be removed.)

Each @emph{logical record} is completely self-contained.  With the help of
the rest of this document each record can be separately and completely decoded;
no other information is needed.

@menu
* Tape Format::			
* Record Blocking::		
* Logical Record Structure::	
@end menu

@node Tape Format, Record Blocking,  , Overview
@section Tape Format

The observation data is archived on magnetic tape.  For historical reasons, the
tapes are written with ANSI standard labels.  ANSI label processing will not be
discussed in this document.  File marks are written occasionally.  They usually
represent a natural break in the observations or the end of the medium.  The
times at which tape marks are written are recorded in the VLA Observing Log.
Since the original archive tapes are not distributed, any tape that is used as
input into a post processing system will be a duplicate.  Tape labels and file
marks are usually not copied to the duplicate tapes.

Normally, a program reading a VLA archive tape will read and process all data
records, ignoring all file marks until the double file mark which indicates the
end of medium.

@node Record Blocking, Logical Record Structure, Tape Format, Overview
@section Record Blocking

A @emph{logical record} contains all the data for one integration time for one
subarray.  The @emph{logical record} can vary in size from about 500 bytes (for
a subarray making single antenna VLBI observations) to about 900k bytes (for a
subarray using all 27 antennas with each baseline producing 512 spectral
channels).  For convenience, the @emph{logical record} is broken into
@emph{physical records}.  

Each @emph{physical record} written to tape is padded to be a multiple of 2048
bytes; the maximum multiple is 13, i.e., the maximum @emph{physical record}
size is

@example
13 x 2048 = 26624 bytes.
@end example

The first two 16-bit words (four bytes) of each @emph{physical record} are
integers used for sequencing, so a @emph{physical record} can contain up to
26620 bytes of the @emph{logical record}.

The two integers used for sequencing are as follows:

@example
n       is the record number of this @emph{physical record} (starting from 1 at the
        beginning of each @emph{logical record})
m       is the total number of @emph{physical records} in this @emph{logical record}.

where, using integer division,

m = [size of @emph{logical record} / 26620] + 1
@end example

The @emph{physical records} are written sequentially: (1,m), (2,m), ..., (m,m).
If m>1, the first (m-1) @emph{physical records} each contain 26620 bytes of the
@emph{logical record}.  The final @emph{physical record} is padded so that it
contains a multiple of 2048 bytes.  If m=1, the only @emph{physical record} is
likewise padded so that it contains a multiple of 2048 bytes.

The two counters can clearly be used to check for missing @emph{physical
records} on the tape and to re-synchronize after tape errors.

@xref{Record Layout}, for a simple pictorial representation of how the
sequence of @emph{physical records} are constructed from a @emph{logical
record}.

@node Logical Record Structure,  , Record Blocking, Overview
@section Logical Record Structure

Each @emph{logical record} is divided into several data areas: the Record
Control Area (RCA), the Subarray Data Area (SDA), a set of Antenna Data Areas
(ADAs) and a set of Correlator Data Areas (CDAs).  Each data area is by
convention padded so as to be a multiple of 4 bytes.  @xref{Record Layout},
for a simple picture of this.

@node The Data Areas, Record Layout, Overview, Top
@chapter The Data Areas

The following encoding is used in the descriptions of the data areas (RCAs, SDA,
ADA):

@example
AS          ASCII (NOT null-terminated; padded with blanks)
I2          2-byte integer (which is format B+15)
I4          4-byte integer (which is format S+31)
FP          4-byte ModComp floating point
DP          8-byte ModComp floating point
B+n or B-n  16-bit scaled binary integer
S+n or S-n  32-bit scaled binary integer
XX          Coded bits
@end example

Throughout this document the term @emph{word} refers to 16-bit (2-byte)
entities.

For further information on the ModComp integer and floating point formats,
@pxref{ModComp Numeric Data Types}.

@menu
* The Record Control Area::	
* The Subarray Data Area::	
* The Antenna Data Area::	
* The Correlator Data Area::	
@end menu

@page

@node The Record Control Area, The Subarray Data Area,  , The Data Areas
@section The Record Control Area

There is one Record Control Area (RCA) which is always the first data area in
the logical record.  The RCA contains global information and pointers.
Pointers are in units of 16-bit words and count from 0 at word 0; i.e., are
offsets from the beginning of the RCA.

@example
Word    Format  Description 
  0- 1    I4    Logical Record Length (words)
  2       I2    Format Type (this is Format 1)
  3       I2    Format Revision Level [1]
  4- 5    I4    Date (MJAD)
  6- 7    I4    IAT Time for the record creation
                (19.2 Hz interrupt count since IAT midnight)
  8-11    AS    Control Program ID (unimplemented)
 12-13    I4    Pointer to Subarray Data Area (SDA)
 14-15    I4    Pointer to first Antenna Data Area (ADA)
 16       I2    Length of each ADA
 17       I2    Number of antennas in this subarray
 18-19    I4    Pointer to First Correlator Data Area (CDA)
 20       I2    Number of words in the baseline record header
 21       I2    Total number of words in a baseline record (including header)
 22-23    I4    Pointer to Second CDA
 24       I2    Number of words in header (c.f. word 20)
 25       I2    Total number of words in a record (c.f. word 21)
 26-27    I4    Pointer to Third CDA
 28       I2    Number of words in header (c.f. word 20)
 29       I2    Total number of words in a record (c.f. word 21)
 30-31    I4    Pointer to Fourth CDA
 32       I2    Number of words in header (c.f. word 20)
 33       I2    Total number of words in a record (c.f. word 21)
 34       I2    record size/block size (The number 13 which is 26624/2048)
 35       XX    (Padding)
@end example

@iftex
@enumerate
@item
@xref{Revision History}.
@end enumerate
@end iftex

@menu
* Revision History::		
@end menu

The details of the meanings of the words 18-33 will be found in the description
of the CDAs (@pxref{The Correlator Data Area}).

@node The Subarray Data Area, The Antenna Data Area, The Record Control Area, The Data Areas
@section The Subarray Data Area

There is one Subarray Data Area (SDA), which can be found through a pointer in
the RCA.  (At present, the SDA follows immediately after the RCA, but this
should not be assumed.)  The SDA contains information peculiar to each
subarray, but common to all data coming from this subarray.

@example
Word    Format  Description
  0       I2    Subarray ID
  1-  8   AS    Source Name
  9       I2    Source Name Qualifier
 10       AS    Array Configuration [1]
 11- 13   AS    Observing Program ID
 14       I2    Observer's AIPS Number 
 15       AS    Observing Mode [2]
 16       AS    first byte - Calibrator code [3]
          XX    second byte - Observing Submode [4]
 17       XX    Array Status Information for IFs A-D [5]
 18       XX    Number of complex frequency channels per baseline
                for each CDA [6]
 19       I2    Integration Time (19.2 Hz interrupt counts)
 20- 21   FP    Stop Time (LST radians)
 22- 23   FP    Start Time (LST radians)
 24- 27   DP    Source RA, at standard epoch (Radians)
 28- 31   DP    Source Dec at standard epoch (Radians)
 32- 35   DP    Apparent RA now (Radians)
 36- 39   DP    Apparent Dec now (Radians)
 40- 55   DP    Signed sum of LOs for IFs A-D (GHz)
 56- 71   DP    Sky Frequency at Band Center (channel 0) for IFs A-D (GHz)
 72- 75   DP    IAT at end of Integration Interval (Radians)
 76- 79   DP    LST at end of Integration Interval (Radians)
 80- 83   DP    IAT for Geometry Calculations (Radians)
 84- 85   FP    Current surface refractivity (n-1)
 86- 87   FP    Estimated zenith atmospheric phase path (nsec)
 88- 95   FP    Sin and Cos of elevation, azimuth
 96- 99   FP    Cos and Sin of parallactic angle
100       XX    Bandwidth codes for IFs A-D [7]
101       XX    Front-end filter codes for IFs A-D [8]
102       XX    Recirculator control codes (currently same as bandwidth code)
103-104   FP    Zero Spacing Flux (Jy)
105-108   FP    UV limits for online ANTSOL (lower, upper) (nsec)
109-110   XX    Array Control Bits [9]
111-120   FP    Weather information [10]
121-136   DP    Radial Velocity for IFs A-D (km/sec) [11]
137-152   DP    Line Rest Frequency for IFs A-D (MHz) [11]
153-156   AS    Velocity Reference Frame for IFs A-D [11]
157-158   AS    Correlator Mode [12]
159-160   AS    Array Processor Options [13]
161       I2    Epoch year [14]
162-165   I2    Channel offsets for IFs A-D
166-169   I2    Channel separation codes for IFs A-D (the k in 50MHz/2**k)
@end example

@page

@iftex
@enumerate
@item
@xref{Array Configurations}.
@item
@xref{Observing Modes}.
@item
@xref{Calibrator Codes}.
@item
@xref{Observing Submodes}.
@item
@xref{Array Status Information}.
@item
@xref{Channels per Baseline}.
@item
@xref{Bandwidth Codes}.
@item
@xref{Front-End Filter Codes}.
@item
@xref{Array Control Bits}.
@item
@xref{Weather Information}.
@item
@xref{Velocity Reference Frame}.
@item
@xref{Correlator Modes}.
@item
@xref{Array Processor Options}.
@item
@xref{Epoch}.
@end enumerate
@end iftex

@menu
* Array Configurations::	
* Observing Modes::		
* Calibrator Codes::		
* Observing Submodes::		
* Array Status Information::	
* Channels per Baseline::	
* Bandwidth Codes::		
* Front-End Filter Codes::	
* Array Control Bits::		
* Weather Information::		
* Velocity Reference Frame::	
* Correlator Modes::		
* Array Processor Options::	
* Epoch::			
@end menu

@node The Antenna Data Area, The Correlator Data Area, The Subarray Data Area, The Data Areas
@section The Antenna Data Area

The next structure is the Antenna Data Area (ADA).  The first ADA can be found
through a pointer in the RCA.  (At present, the first ADA follows immediately
after the SDA, but this should not be assumed.)  The length of each ADA and the
number of antennas in the subarray are also specified in the RCA.  The ADAs
follow one another sequentially.  There is one for each antenna present, and
their order determines the order of the correlator data.

@example
Word    Format  Description
  0       XX    first byte - Antenna ID
          XX    second byte - DCS address
  1- 2    XX    Antenna Control Bits [1]
  3       XX    IF Status for IFs A-D (c.f. SDA Word 17) [2]
  4-11    FP    Nominal Sensitivity for IFs A-D (unitless)
 12-19    FP    Peculiar Delay for IFs A-D (nsec)
 20-23    B+0   Peculiar Phase for IFs A-D (turns)
 24-27    DP    Total Delay at "geometry" epoch (nsec)
 28-33    FP    U, V and W at center of integration for specified Epoch (nsec)
 34-45    DP    Apparent Bx, By and Bz (nsec)
 46-47    FP    Ba (K-term) (nsec)
@end example

@iftex
@enumerate
@item
@xref{Antenna Control Bits}.
@item
@xref{Array Status Information}.
@end enumerate
@end iftex

@menu
* Antenna Control Bits::	
* Array Status Information::
@end menu

@node The Correlator Data Area,  , The Antenna Data Area, The Data Areas
@section The Correlator Data Area

The last structure is the Correlator Data Area (CDA).  The CDAs can be found
through the pointers in the RCA.  There are always 2 CDAs in continuum mode
(except for early tapes when there was only one).  In spectral line mode, there
may be one to four CDAs.

The use of the four CDAs is defined based on correlator mode.  The four
pointers in the RCA point to the different CDA areas (@pxref{CDA Pointer
Definitions}).  A null (zero) pointer indicates that there is no data for this
CDA

The natural ordering of data from the correlator is all spectra for each
baseline in spectral line mode.  In continuum, it is all AC data for each
baseline, this for all baselines; and then all BD data for each baseline.  The
ordering of continuum data is preserved here, but note that the spectral line
data has been re-ordered in the archive format to be all baselines for each
spectrum.  This is more in keeping with the way continuum data appears and is,
in general, easier to deal with.

Included in the archive tape is all auto-correlation data as well as the
cross-correlation data.  Each CDA contains all the appropriate auto-correlation
data for all antennas in this subarray, followed by all the cross-correlation
data.  The order of both sets of data is determined by the order of the ADAs.

The auto-correlation data is not of much use in continuum mode; it is suggested
to replace it with the separately integrated crossed-hand auto-correlations
which will be provided in the future.

The following pseudo-code describes an algorithm to obtain the data from the
CDA.

@menu
* CDA layout::			
* Baseline Record Header::	
* The Scale Factor::		
@end menu

@page

@node CDA layout, Baseline Record Header,  , The Correlator Data Area
@subsection CDA layout

For each CDA, the @emph{correlator data area pointer} and the @emph{total
number of words in a baseline record} is specified in the RCA (@pxref{The
Record Control Area}).

The following loop will find the data associated with a given antenna or
baseline:

@example
ptr = (pointer to correlator data area)
nw  = (total number of words in a baseline record)

N = 0;
Do for I = 1 to (no. of antennas) by 1;

     pointer = ptr + N*nw
     Comment auto-correlation data for antenna I is located here;
     N = N + 1;

Do for I = 1 to (no. of antennas)-1 by 1;

     Do for J = I+1 to (no. of antennas) by 1;

          pointer = ptr + N*nw
          Comment cross-correlation data for the baseline between the
                  Ith and Jth antennas is located here;
          Comment the following formulae can be used to find
                  the ADAs for the Ith and Jth antennas:
                  (ADA pointer) + (I-1)*(ADA length) for I,
                  (ADA pointer) + (J-1)*(ADA length) for J;
          N = N + 1;

     End;
End;
@end example

For continuum, the data block looks like:

@example
header
correlation of IF A of the Ith antenna with IF A of the Jth antenna.
correlation of IF C of the Ith antenna with IF C of the Jth antenna.
correlation of IF A of the Ith antenna with IF C of the Jth antenna.
correlation of IF C of the Ith antenna with IF A of the Jth antenna.
@end example

@xref{CDA Diagram for Continuum}, for a simple diagram.

For each CDA, the @emph{number of words in the baseline record header} is
specified in the RCA (@pxref{The Record Control Area}).

Each correlation mentioned above will consist of three words each containing a
2-byte integer:

@example
real part.
imaginary part.
modified variance.
@end example

For spectral line, the @emph{number of complex frequency channels per baseline}
(@pxref{Channels per Baseline}) gives the number (M) of complex frequency
channels that will be accumulated per baseline.  The correlation data for each
baseline is laid out as follows:

@example
header
correlator channel 0, real part.
correlator channel 0, imaginary part.
correlator channel 1, real part.
correlator channel 1, imaginary part.
:
correlator channel M-1, real part.
correlator channel M-1, imaginary part.
@end example

Each correlation part is stored as a 2-byte integer in a single word.  @xref{CDA
Diagram for Spectral Line}, for a simple diagram

@menu
* CDA Pointer Definitions::	
* CDA Diagram for Continuum::	
* CDA Diagram for Spectral Line::  
@end menu

@page

@node Baseline Record Header, The Scale Factor, CDA layout, The Correlator Data Area
@subsection Baseline Record Header

The header words in the baseline record are laid out as follows:

@example
 Word               Description
(-2-n)  Bit map     (spectral line only) one bit per channel in the spectrum.
  to
 (-3)   n=1         (i.e., one word of bit map) if M<16
        n=M/16      (i.e., M/16 words of bit map) otherwise

        where M is the number of frequency channels in the baseline

  -2    Bits 0-1    a 2-bit integer describing the type of flagging
                     0       The whole baseline is bad
                     1       Some channels are bad
                     2 or 3  Some channel is bad for all baselines
        Bits 3-4    unused
        Bits 5-7    describe cause of flagging
                     5  Frequency RMS too big
                     6  Time RMS too big
                     7  Value too big (clip)
        Bits 11-15  5 bit scale factor (exponential)

  -1    Bits  0-3   (continuum only) 4-bit Bit map for flagging (AA,CC,AC,CA)
        Bits  6-10  first antenna number in this baseline
        Bits 11-15  second antenna number

@end example

The flagging information is to allow flagging of individual spectral channels.
If bit p is set (i.e., 1), then channel p is flagged bad.  The scheme outlined
here is based on one suggested by Barry Clark and seems appropriate for both
spectral line and continuum.  However, it is not yet implemented.

@strong{At present only the scale factor and the antenna numbers are supported
in the header.}

@page

@node The Scale Factor,  , Baseline Record Header, The Correlator Data Area
@subsection The Scale Factor

To conserve space and to optimize precision the correlation data are stored as
16-bit integers with a block scale factor.  A separate scale factor is
specified for each baseline.  In continuum, there is one scale factor for each
half-correlator (AC or BD).  In spectral line there is one for each spectrum.

When writing a baseline record, all integer values are left shifted (multiplied
by 2) such that the largest value in the block has the most significant bit
set; the number of places shifted is recorded in the scale factor.  To
reconstruct the value f (the real or imaginary part of a correlation) from the
stored integer v and scale factor g (from the header):

@example
f = v / 2**g
@end example

@node Record Layout, ModComp Numeric Data Types, The Data Areas, Top
@appendix Record Layout

@example
        Logical record                        Physical records

 ------------------------------              -----------------
 | RCA  record control area   |              | 2 word header |     
 ------------------------------              |...............|               
 | SDA  subarray data area    |              |     first     |  26624 bytes
 ------------------------------              |  26620 bytes  |  13312 words
 | ADA  antenna data areas    |              |   from the    |
 ------------------------------              |  logical rec  |
 |                            |              -----------------
 | CDA  correlator data areas |
 |                            |              -----------------
 ------------------------------              | 2 word header |
                                             |...............|  26624 bytes
                                             |     next      |  13312 words
                                             |  26620 bytes  |
                                             -----------------

                                                 etc. until

                                             -----------------
                                             | 2 word header |
                                             |...............|  padded to a
                                             |   residual    |  multiple of
                                             |   from the    |   2048 bytes
                                             |  logical rec  |   1024 words
                                             | plus padding  |
                                             -----------------
@end example

The two word header is

@example
n  Sequence number (n = 1 ... m)
m  Total number of physical records in this logical record
@end example

@node ModComp Numeric Data Types, RCA details, Record Layout, Top
@appendix ModComp Numeric Data Types

The ModComp, like all computers, has its own individual ways of representing
and storing numbers.  Also, the VLA has created some new formats and
conventions.  Trying to link all this together has gone far to ensure that the
number one computer language used on site is profanity!  However, we will make
the best of it and attempt to explain the differences.

The numeric types used on the ModComp's are explained below.  Bit designations
are from left to right, bit 0 (most significant) to bit 15 in a 16-bit word.
All numbers have the sign in the leftmost bit (bit 0); negative numbers are
two's complement.

@emph{Integers} are either 16-bit (single-precision, the ModComp standard), or
32-bit (double-precision).  Each assumes a binary point after the rightmost bit
(the assumed scaling is B+15 or S+31; see scaled binary integers below).

@emph{Scaled Binary Integers} are arithmetically equivalent to integers, but
the binary point is not assumed to be at the far right.  The convention is to
call the binary point position just to the right of the sign bit (between bit 0
and bit 1) binary point position 0 and to count positively to the right.  "B"
represents a 16-bit (single-precision) number; "S" a 32-bit (double-precision)
number.  For example, given the 16-bit binary number

@example
     0100 0000 0000 0001
@end example

the following scalings would yield the following values:

@example
     B+0          0.100 0000 0000 0001
     B+10         0100 0000 000.0 0001
     B-3    00.00 0100 0000 0000 0001
     B+20         0100 0000 0000 0001 0000 0.000
@end example

@page

@emph{Floating Point} numbers are of two basic types.  @emph{Single-Precision
Floating Point} (FP) numbers have bit 0 as the sign, bits 1-9 as the exponent,
and bits 10-31 as the mantissa.  Note each floating point number uses two
ModComp words.  The binary point is assumed before bit 10.  Therefore

@example
     0eee eeee eemm mmmm mmmm mmmm mmmm mmmm
@end example

decodes into

@example
     0.mm mmmm mmmm mmmm mmmm mmmm * 2**(eee eeee ee - 100 0000 00).
@end example

Floating point numbers are usually normalized, i.e., the first mantissa bit is
the complement of the sign bit.  @emph{Double-Precision Floating Point} (DP)
numbers are identical except that the mantissa contains 32 more bits.
Therefore, DP numbers take four ModComp words with bits 10-63 as the mantissa.
(Note this is not the same as the IEEE 794 standard, where double precision has
more bits in the exponent than single precision.)

@node RCA details, SDA details, ModComp Numeric Data Types, Top
@appendix RCA Details

@menu
* Revision History::		
@end menu

@node Revision History,  ,  , RCA details
@appendixsec Revision History

The following is a table containing the format revision history, with the
significant changes made at each revision.

@example
Revision  Date

    3    76Jun28        Initial supported revision level
    4    78Jan24        Weather information recorded.
    5    78May17        (u, v) recorded as FP of epoch.  It had earlier
                        been an integer in units of 16's of nsec of date
    6    79Apr05        Spectral line data available.
    7    82Apr01
    8    83Jun08        BD continuum available;
                        array configuration information available;
                        change from observer name to program code.
    9    83Jun17
   10    83Aug10        Additional spectral line information available:
                        radial velocity, line rest frame, velocity
                        reference frame, and channel offsets; enough
                        information to determine the channel separation
                        correctly in all cases (Hanning flag).
                        Epoch year included.
   11    84Feb16
   12    86Mar05        Radio/Optical velocity definition added.
   20    87Nov11        New format for testing only
         88Jan02        Begin commissioning of new system
                        Channel offsets omitted (set to 0)
                        Bandwidth code 8 reported incorrect channel width
   21    89Jan18        Channel offsets corrected
                        All bandwidth codes reported incorrect channel width
   22    89Apr05        All bandwidth codes except 8 now reported correctly
   23    90Feb07        auto-correlations included
                        All spectral line modes implemented
   24    90Mar28        Bandwidth code 8 finally fixed!
@end example

Revisions 3-12 were before the upgrade to the ModComp Classic computers.  The
data format was in detail very different from the one described in this
document.  This format is completely documented in the references by Randolph
(revisions 1-3) and Sowinski (3-12) (@pxref{References}).

However, a program to convert from the old format to the new makes it
unnecessary for a person reading an archive tape to be aware of the details of
the old format.  Some changes between the early revision levels (3-12) are
hidden by this program and are not listed here.  However, it is important to
note that several pieces of information available on the current format
(revisions 20 and greater) were not written on the old tape, and could not be
recreated.  These are:

@example
SDA     IAT for Geometry Calculations
SDA     Front-end filter codes
SDA     Zero Spacing Flux
ADA     Peculiar Delay
ADA     Total Delay at "geometry" epoch
ADA     Bx, By, Bz
ADA     Ba (K-term)
@end example

@node SDA details, ADA details, RCA details, Top
@appendix SDA Details

@menu
* Array Configurations::	
* Observing Modes::		
* Calibrator Codes::		
* Observing Submodes::		
* Array Status Information::	
* Channels per Baseline::	
* Bandwidth Codes::		
* Front-End Filter Codes::	
* Array Control Bits::		
* Weather Information::		
* Velocity Reference Frame::	
* Correlator Modes::		
* Array Processor Options::	
* Epoch::			
@end menu

@node Array Configurations, Observing Modes,  , SDA details
@appendixsec Array Configurations

The word containing the VLA array configuration has two characters; the
possible values are:

@example
"A "
"B "
"C "
"D "
"AB"
"BC"
"CD"
@end example

@node Observing Modes, Calibrator Codes, Array Configurations, SDA details
@appendixsec Observing Modes

The word containing the observing mode has two characters; the possible
values are:

@example
"  "    standard observing
"D "    delay center determination mode
"H "    holography raster mode
"I*"    interferometer pointing mode, where * = "A", "B", "C", or "D" (IF)
"J*"    JPL mode, where * = "A", "B", "C", or "D" (IF)
"P*"    single dish pointing mode, where * = "A", "B", "C", or "D" (IF)
"S "    solar observing configuration
"SP"    solar observing with low accuracy ephemeris for the sun
"TB"    test back-end and front-end
"TE"    tipping curve
"TF"    test front-end
"VA"    self-phasing mode for VLBI phased-array mode
"VS"    single dish VLBI
"VX"    applies last phase update from source line using VA mode
@end example

@page

@node Calibrator Codes, Observing Submodes, Observing Modes, SDA details
@appendixsec Calibrator Codes

The byte containing the calibrator code has a single character specifying the
quality of the source:

@example
"A"    astrometric quality (position known to within 0.001 arcsec)
"B"    near astrometric quality (position known to within 0.01 arcsec)
"C"    not astrometric quality (position known to within 0.05 arcsec)
"T"    point source; flux and position badly determined
"P"    an assumed calibrator for pointing observation
"V"    an assumed calibrator for phased array observation
" "    not a calibrator
@end example

@node Observing Submodes, Array Status Information, Calibrator Codes, SDA details
@appendixsec Observing Submodes

The byte containing the observing submode has an 8-bit integer describing the
VLA submode for those observing modes that step through different phases.

In normal observing mode (" ") and in holography mode ("H"), when things are
not constant during an entire scan, a non-zero observing submode is used to
indicate a new configuration.  In normal observing mode, this represents
@emph{survey mode}; a new observing submode indicates a new phase reference
position.  In holography mode, the submode represents a new pointing position
on the current raster.  This mechanism may be extended to other quantities in
the future.

@page

The following table gives the other meanings of the submodes:

@example
Submode          Observing Mode
               P*      I*      D

 1             -       -       -
 2             ON      ON     +14
 3             -       -       -
 4            +EL     +EL     -14
 5             -       -       -
 6            -EL     -EL      -7
 7             -       -       -
 8            +AZ     +AZ       0
 9             -       -       -
10            -AZ     -AZ      +7
11             -
12            OFF
13             -
14             ON
15             -
16            OFF
17             -
18            OFF

where

 -     invalid data during move to next phase

ON     antennas pointing to nominal on-source position
+/-AZ  antennas pointing off source by a half beamwidth in azimuth
+/-EL  antennas pointing off source by a half beamwidth in elevation
OFF    antennas pointing off source by +2.5 beamwidths in azimuth

 0     antenna delays set to their nominal values
+/-n   antenna delays stepped by n*2**(bandwidth code) nsec
@end example

No other observing submodes should occur for these observing modes.  During all
other observing modes the submode is always zero.

@page

@node Array Status Information, Channels per Baseline, Observing Submodes, SDA details
@appendixsec Array Status Information

The word containing the array status information is divided into four 4-bit
areas, one for each IF, "A", "B", "C", and "D" respectively:

@example
  A     B     C     D
xxxx  xxxx  xxxx  xxxx
@end example

Each set of 4 bits contains a flag indicating IF status; the further
left the bit appears, the worse the quality of data; the following hold
for each set:

@example
xxxx = 0000 = 0      ==> OK
xxxx = 0001 = 1(int) ==> warning
xxxx = 0010 = 2(int) ==> not so good
xxxx = 0100 = 4(int) ==> bad
xxxx = 1000 = 8(int) ==> extremely bad
@end example

(These bits may be combined; i.e., 0101 is possible)

@node Channels per Baseline, Bandwidth Codes, Array Status Information, SDA details
@appendixsec Channels per Baseline

The word containing the number of complex frequency channels per baseline is
divided into four 4-bit areas, one for each CDA area:

@example
CDA1  CDA2  CDA3  CDA4
xxxx  xxxx  xxxx  xxxx
@end example

Each set of 4 bits represents an integer k, where the number of complex
frequency channels per baseline is 2**k.; e.g.,

@example
CDA1
xxxx = 0101 ==> 1st CDA contains 2**5 = 32 channels per baseline
@end example

This word applies to spectral line data only; for continuum data, the word
contains zeroes.

@node Bandwidth Codes, Front-End Filter Codes, Channels per Baseline, SDA details
@appendixsec Bandwidth Codes

The word containing the bandwidth codes is divided into four 4-bit areas, one
for each IF, "A", "B", "C", and "D" respectively:

@example
  A     B     C     D
xxxx  xxxx  xxxx  xxxx
@end example

Each set of 4 bits contains a 4-bit integer representing the following:

@example
                    Spectral Line                     Continuum

 4-bit          Bandwidth     maximum # of            Bandwidth
integer         analyzed      channels*IF

   0             50   MHz         16                   50   MHz
   1             25   MHz         32                   25   MHz
   2             12.5 MHz         64                   12.5 MHz
   3              6.3 MHz        128                    6.3 MHz
   4              3.1 MHz        256                    3.1 MHz
   5              1.5 MHz        512                    1.5 MHz
   6              0.8 MHz        512                    0.8 MHz
   7              0.8 MHz        512                    0.2 MHz
   8              0.2 MHz        256                      -
   9              0.2 MHz        512                      -
@end example

Integers 10-15 should not occur.

More precise information can be found in the references by Hunt and Rots
(@pxref{References}).

@page

@node Front-End Filter Codes, Array Control Bits, Bandwidth Codes, SDA details
@appendixsec Front-End Filter Codes

The word containing the front-end filter codes is divided into four 4-bit
areas, one for each IF, "A", "B", "C", and "D" respectively:

@example
  A     B     C     D
xxxx  xxxx  xxxx  xxxx
@end example

Each set of 4 bits contains a 4-bit integer representing the following:

@example
 4-bit         front-end
integer          filter

  0             50   MHz
  1             25   MHz
  2             12.5 MHz
  3             "wire"                  no filter inserted
  4             "open"                  input and output not connected!
@end example

Integers 5-15 should not occur.

@node Array Control Bits, Weather Information, Front-End Filter Codes, SDA details
@appendixsec Array Control Bits

The 2 words containing the array control have 32 bits.  If a bit is set (i.e.,
1), the condition is true; if unset (i.e., 0), false.  The bit numbering is
from the left (most significant bit) starting with 0; Only the most significant
6 bits are currently defined.

@example
bit #   description               encoding

  0     deicers on
  1     weather station broken
  2     correlator self test disabled
  3     Socorro Electric Co. is not providing power
  4     correlator is gated for pulsar observation
  5     weather information is generated from operator-supplied data,
             not from a computer generated model
@end example

(bit 5 is applicable only if bit 1 is set; i.e., the weather station is broken)

@node Weather Information, Velocity Reference Frame, Array Control Bits, SDA details
@appendixsec Weather Information

The 10 words containing the weather information have five floating point
numbers as follows:

@example
Wind speed                      m/sec
Wind direction                  degrees from North (through East)
Surface temperature             degrees Celsius
Barometric pressure             millibars
Dew point temperature           degrees Celsius
@end example

@page

@node Velocity Reference Frame, Correlator Modes, Weather Information, SDA details
@appendixsec Velocity Reference Frame

The 4 words containing the velocity reference frame are divided into pairs of
characters, one pair for each IF.

There are two conditions.  Either

@example
"*F" or "* "  the baseband synthesizers have been explicitly set by the
              observer (* is any character)
@end example

otherwise Doppler correction was applied using the following criteria:

@example
"Tx"    Topocentric rest frame; velocity in km/s, rest frequency in MHz
"Gx"    Geocentric rest frame; velocity in km/s, rest frequency in MHz
"Bx"    Barycentric rest frame; velocity in km/s, rest frequency in MHz
"Lx"    LSR rest frame; velocity in km/s, rest frequency in MHz

where "x" represents the velocity switch and can be one of the following:

"O"     Offset frequency
"Z"     Doppler correction using the Optical definition
"V"     Doppler correction using the Radio definition
@end example

For each IF, the observing frequency was determined using this field together
with the Radial Velocity (RV - km/s) and the Line Rest Frequency (LRF - MHz) as
follows:

@example
LRF (MHz) * DCE * DCS

where DCE = 1/(1 + VE/c)        optical
      DCS = 1/(1 + RV/c)

where DCE = (1 - VE/c)          radio
      DCS = (1 - RV/c)

  and VE (km/s) is the component of the Earth's velocity in the
                direction of the source in the specified velocity
                reference frame, determined at the beginning of the
                current "scan".
@end example

More extensive information can be found in the reference by Rots
(@pxref{References}).

@node Correlator Modes, Array Processor Options, Velocity Reference Frame, SDA details
@appendixsec Correlator Modes

The 2 words containing the correlator mode have 4 characters; the possible
values are:

@example
"    "          continuum mode; all other modes are spectral line
"1A  "          single IF mode, IF "A"
"1B  "          single IF mode, IF "B"
"1C  "          single IF mode, IF "C"
"1D  "          single IF mode, IF "D"
"2AB "          dual IF mode, IFs "A" and "B"
"2AC "          dual IF mode, IFs "A" and "C"
"2AD "          dual IF mode, IFs "A" and "D"
"2BC "          dual IF mode, IFs "B" and "C"
"2BD "          dual IF mode, IFs "B" and "D"
"2CD "          dual IF mode, IFs "C" and "D"
"4   "          four IF mode
"PA  "          polarization mode, IFs "A" and "C"
"PB  "          polarization mode, IFs "B" and "D"
@end example

@node Array Processor Options, Epoch, Correlator Modes, SDA details
@appendixsec Array Processor Options

The 2 words containing the array processor options have four characters.  The
following characters may appear in any combination and in any order:

@example
"H" - Hanning smoothing
"B" - Band pass normalization
"L" - Lag spectrum (raw correlator output)
@end example

@node Epoch,  , Array Processor Options, SDA details
@appendixsec Epoch

This 2-byte integer represents the epoch of the coordinates of observation.
This parameter is typically 1950 or 2000.  The value -1 is used to indicate
epoch of date.

@node ADA details, CDA details, SDA details, Top
@appendix ADA Details

@menu
* Antenna Control Bits::	
@end menu

@node Antenna Control Bits,  ,  , ADA details
@appendixsec Antenna Control Bits

The 2 words containing the antenna control bits have 32 bits.  If a bit is set
(i.e., 1), the condition is true; if unset (i.e., 0), false.  The bit numbering
is from the left (most significant bit) starting with 0:

@example
bit #   description

  0     transfer switch set
  1     this antenna is a reference antenna
  2     reference antenna (same as bit 1 currently)
  3- 4  unused
  5     round trip phase correction disabled
  6     antenna off source
  7     antenna elevation "over-the-top"
  8     phase switching disabled
  9     unused
 10     antenna shadowed by another at source change time
        (this includes shadowing by antennas not in this subarray)
 11     real-time pointing correction applied
 12     solar cal activated
 13     solar attenuator inserted
 14-15  (for controlling auxiliary front-end switches 3 and 4 which are
        currently unused)

The following bits are flagging conditions:

 16     source change in progress
 17     sub-reflector not in position
 18     antenna off source
 19     L6 module not locked
 20     L8 module not locked
 21     back-end filters misset
 22     back-end total power out of range
 23     antenna flagged bad by Operator
 24     Tsys fluctuating
 25     first LO not locked
@end example

@node CDA details, References, ADA details, Top
@appendix CDA Details

@menu
* CDA Pointer Definitions::	
* CDA Diagram for Continuum::	
* CDA Diagram for Spectral Line::  
@end menu

@node CDA Pointer Definitions, CDA Diagram for Continuum,  , CDA details
@appendixsec CDA Pointer Definitions

Each entry in the table below describes what data is pointed to by each of the
four pointers in the RCA for each of the possible correlator modes.

@example
0    denotes that there is no data for this CDA
()   denotes an IF pair in continuum
/    denotes one of the mixed line and continuum modes
@end example

Only two CDAs are used for continuum; up to four for spectral line.

@example
Correlator Mode       1st Ptr 2nd Ptr 3rd Ptr 4th Ptr

Continuum              (AC)    (BD)     0       0
"1A  "                  AA      0       0       0
"1B  "                  0       BB      0       0
"1C  "                  0       0       CC      0
"1D  "                  0       0       0       DD
"2AB "                  AA      BB      0       0
"2AC "                  AA      0       CC      0
"2AD "                  AA      0       0       DD
"2BC "                  0       BB      CC      0
"2BD "                  0       DD      0       BB
"2CD "                  0       0       CC      DD
"4   "                  AA      BB      CC      DD
"PA  "                  AA      CC      AC      CA
"PB  "                  BB      DD      BD      DB
"1A/C"                  AA     (BD)     0       0
"1B/C"                 (AC)     BB      0       0
"1C/C"                  0      (BD)     CC      0
"1D/C"                 (AC)     0       0       DD
"2AC/C"                 AA     (BD)     CC      0
"2BD/C"                (AC)     BB      0       DD
@end example

NOTE: the last six entries in the table are for future expansion, and are
currently undefined ("/C" indicates "continuum").

@node CDA Diagram for Continuum, CDA Diagram for Spectral Line, CDA Pointer Definitions, CDA details
@appendixsec CDA Diagram for Continuum

The following is diagram of the CDA for continuum data: 

@example
                 Body                             Each correlation block

       ---------------------------              --------------------------
       |          Nant           |          /\  |   Header (see below)   |
       |    Auto-correlations    |           |  |........................|
       |.........................|           |  |                        |
       |                         |           N  |          Data          |
       |    Nant * (Nant-1)/2    |           |  |                        |
       |    Cross-correlations   |           |  |       (12 words)       |
       |                         |          \/  |                        |
       |     (see at right)      |              --------------------------
       |                         |
       ---------------------------
                                                          Header
     H = 2, N = 14                              --------------------------
                                            /\  |       0       | Scale  |
                                             H  |........................|
     Flag map is for AA, CC, AC, CA         \/  | Map |     Baseline     |
     Baseline is two 5-bit antenna numbers      --------------------------

     The 12 words are:
           for AA, CC, AC, CA
               (real part, imaginary part, modified variance)
where
     Nant is the number of antennas (from RCA)
@end example

@page

@node CDA Diagram for Spectral Line,  , CDA Diagram for Continuum, CDA details
@appendixsec CDA Diagram for Spectral Line

The following is a diagram of the CDA for spectral line data:

@example
                 Body                             Each correlation block

       ---------------------------              --------------------------
       |          Nant           |          /\  |   Header (see below)   |
       |    Auto-correlations    |           |  |........................|
       |.........................|           |  |                        |
       |                         |           N  |          Data          |
       |    Nant * (Nant-1)/2    |           |  |                        |
       |    Cross-correlations   |           |  |      (M * 2) words     |
       |                         |          \/  |                        |
       |     (see at right)      |              --------------------------
       |                         |
       ---------------------------
                                                          Header
     H = 2 + max (1, M/16)                      --------------------------
     N = H + M * 2                          /\  |                        |
                                             |  |   max (1, M/16) words  |
                                             |  |       Flag map         |
                                             |  |   (currently not set)  |
    Baseline is two 5-bit antenna numbers    H  |                        |
                                             |  |........................|
                                             |  |       0       | Scale  |
                                             |  |........................|
                                            \/  |  0  |     Baseline     |
                                                --------------------------
where
     Nant is the number of antennas (from the RCA)
     M is the number of complex frequency channels per baseline
          (from the SDA)
@end example

@node References,  , CDA details, Top
@appendix References

@example
General:

  A.R. Thompson, B.G. Clark, C.M. Wade, and P.J. Napier, "The Very Large
    Array," ApJS 44 p151, 1980

  P.J. Napier, A.R. Thompson, and R.D. Ekers, "The Very Large Array: Design
    and Performance of a Modern Synthesis Radio Telescope," Proc. IEEE 71
    p1295, 1983

  R.M. Hjellming (ed.), "An Introduction to the NRAO Very Large Array"
    (also known as "The Green Book"), 1983

Local oscillators and spectral line:

  G.C. Hunt, "Concerning VLA Local Oscillator Settings," VLA Computer memo
    148, 1978

  A.H. Rots, "A Short Guide for VLA Spectral Line Observers," Edition 8.0,
    1990

Previous documents:

  W.E. Randolph, "Data Format from Synchronous System," VLA Computer memo
    126, 1975 

  K.P. Sowinski, "Synchronous System Data Formats," VLA Computer memo 185,
    1986
@end example

@contents
@bye
